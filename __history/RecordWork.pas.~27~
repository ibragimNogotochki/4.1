unit RecordWork;

interface

Uses System.SysUtils;

Type
  TAppliance = Record
    InvNumber: Integer;
    Name: String[10];
    Purpose: String[70];
    ProdDate: String[10];
    Price: Integer;
  End;

  TRecArray = Array Of TAppliance;

Function CreateRec(Const InvNumber, Price: Integer;
  Const Name, Purpose, ProdDate: String): TAppliance;

Procedure WriteRecToFile(Const RecToWrite: TAppliance; Const FilePath: String);

Function LoadRecsFromFile(Const FilePath: String): TRecArray;

implementation

Function CreateRec(Const InvNumber, Price: Integer;
  Const Name, Purpose, ProdDate: String): TAppliance;
Var
  Res: TAppliance;
Begin
  Res.InvNumber := InvNumber;
  Res.Price := Price;
  Res.Name := Name;
  Res.Purpose := Purpose;
  Res.ProdDate := ProdDate;
  CreateRec := Res;
End;

function SeekPosInFile(Recs: TRecArray; Const NewRecNum: Integer): Integer;
Var
  Right, Left, Middle: Integer;
  IsPosFound: Boolean;
Begin
  Right := High(Recs);
  Left := 0;
  If Length(Recs) = 1 Then
    If Recs[0].InvNumber > NewRecNum Then
      Middle := 0
    Else
      Middle := 1
  Else
    Repeat
      Middle := (Right + Left) Div 2;
      IsPosFound := (Recs[Middle - 1].InvNumber <= NewRecNum) And
        (NewRecNum <= Recs[Middle + 1].InvNumber);
      If Not IsPosFound Then
      Begin
        If Recs[Middle - 1].InvNumber <= NewRecNum Then
          Right := Middle - 1
        Else
          Left := Middle + 1;
      End;
    Until IsPosFound;
  SeekPosInFile := Middle;
End;

Procedure WriteRecToFile(Const RecToWrite: TAppliance; Const FilePath: String);
Var
  WFile: File Of TAppliance;
  PrevRecs: TRecArray;
  I, NewRecPos: Integer;
Begin
  AssignFile(WFile, FilePath);
  If FileExists(FilePath) Then
    PrevRecs := LoadRecsFromFile(FilePath);
  Rewrite(WFile);
  If Length(PrevRecs) = 0 Then
    Write(WFile, RecToWrite)
  Else
  Begin
    For I := Low(PrevRecs) To High(PrevRecs) Do
      Write(WFile, PrevRecs[I]);
    NewRecPos := SeekPosInFile(PrevRecs, RecToWrite.InvNumber);
    Seek(WFile, NewRecPos);
    Write(WFile, RecToWrite);
  End;
  CloseFile(WFile);
End;

Function LoadRecsFromFile(Const FilePath: String): TRecArray;
Var
  RFile: File Of TAppliance;
  Res: TRecArray;
  I, RecCount: Integer;
Begin
  AssignFile(RFile, FilePath);
  Reset(RFile);
  SetLength(Res, FileSize(RFile));
  For I := 0 To High(Res) Do
    Read(RFile, Res[I]);
  CloseFile(RFile);
  LoadRecsFromFile := Res;
End;

end.
